# Decision Support Systems
对于只读OLAP数据库，通常有一个分岔的环境，其中有多个OLTP数据库实例，这些实例从外部世界摄取信息，然后将这些信息馈送到后端OLAP数据库(有时称为数据仓库)。有一个中间步骤称为ETL，即提取、转换和加载，它将OLTP数据库组合为数据仓库的通用模式。
当前的现代趋势(而不是ETL)是ELT，即提取、加载和转换。一旦加载了原始数据，转换就会在OLAP数据库本身上完成。
决策支持系统(DSS)是服务于组织的管理、操作和计划级别的应用程序，通过分析存储在数据仓库中的历史数据，帮助人们对未来的问题和问题做出决策。
对分析数据库建模的两种方法是星型模式和雪花模式。
## 星型模式
星型模式包含两种类型的表:事实表和维度表。事实表包含应用程序中发生的多个“事件”。它将包含每个事件的最小唯一信息，然后其余属性将是对外部维度表的外键引用。维度表包含跨多个事件重用的冗余信息。在星型模式中，事实表中只能有一个维度级别。由于数据只能具有一层维度表，因此它可能具有冗余信息。非规范化的数据模型可能导致完整性和一致性违规，因此必须相应地处理复制。星型模式上的查询(通常)比雪花型模式更快，因为连接更少。图1显示了一个星型模式的示例。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/26927011/1715358762665-553c3884-fbfd-4d39-968c-9049ee2c625e.png#averageHue=%23f6f5f4&clientId=uaf2a2998-5421-4&from=paste&height=423&id=u76fceeed&originHeight=529&originWidth=769&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=103244&status=done&style=none&taskId=u8741cb34-207b-4da7-9cfa-79e85132e1b&title=&width=615.2)
## 雪花模式
雪花模式类似于星型模式，不同之处在于它们允许事实表之外的多个维度。它们占用较少的存储空间，但需要更多的连接来获取查询所需的数据。由于这个原因，对星型模式的查询通常更快。图2显示了雪花模式的一个示例。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/26927011/1715358855709-9e5e9426-f133-4aa3-9a1b-c520fe8e19fe.png#averageHue=%23f9f8f7&clientId=uaf2a2998-5421-4&from=paste&height=280&id=ue04cb88c&originHeight=350&originWidth=545&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=48588&status=done&style=none&taskId=ua1f9b524-d7b3-4296-b64a-c1d25d27cd9&title=&width=436)
# Execution Models执行模型
分布式DBMS的执行模型指定了它在查询执行期间如何在节点之间进行通信。执行查询的两种方法是pushing and pulling.
## 将查询推送到数据
对于第一种方法，DBMS将查询(或查询的一部分)发送到包含数据的节点。
然后，在通过网络传输数据之前，它会对数据所在的位置进行尽可能多的过滤和处理。然后将结果发送回正在执行查询的位置，该位置使用本地数据和发送给它的数据来完成查询。这在无共享系统中更为常见。
## 将数据拉到查询
对于第二种方法，DBMS将数据带到正在执行查询的节点，该查询需要数据进行处理。换句话说，节点检测它们可以在哪些数据分区上进行计算，并相应地从存储中提取数据。然后，将本地操作传播到一个节点，该节点对所有中间结果执行操作。这是共享磁盘系统通常会做的事情。这样做的问题是，相对于查询的大小，数据的大小可能非常不同。还可以发送筛选器，以便仅从磁盘检索所需的数据。
## 查询容错节点
从远端接收到的数据将被缓存在缓冲池中。这允许DBMS支持大于可用内存量的中间结果。但是，临时页在重新启动后不会被持久化。因此，分布式DBMS必须考虑，如果节点在执行期间崩溃，长时间运行的OLAP查询会发生什么情况。
大多数无共享的分布式OLAP dbms都假定节点在查询执行期间不会失败。如果在查询执行期间有一个节点失败，那么整个查询就会失败，这就需要从头开始执行整个查询。这可能代价高昂，因为一些OLAP查询可能需要几天的时间才能执行。
DBMS可以在执行期间对查询的中间结果进行快照，以便在节点失败时进行恢复。但是，这个操作开销很大，因为将数据写入磁盘的速度很慢。

# Query Planning
我们之前讨论的所有优化仍然适用于分布式环境，包括谓词下推、早期预测和最优连接排序。分布式查询优化更加困难，因为它必须考虑数据在集群中的物理位置和数据移动成本。
## 查询计划片段
一种方法是生成单个全局查询计划，然后将物理操作符分发到节点，将其分解为特定于分区的片段。大多数系统都实现了这种方法。
另一种方法是使用SQL查询并将原始查询重写为特定于分区的查询。
这允许在每个节点进行局部优化。SingleStore和Vitess就是使用这种方法的例子

# Distributed Join Algorithms分布式连接算法
对于分析工作负载，大部分时间花在连接和从磁盘读取数据上，这显示了这个主题的重要性。分布式连接的效率取决于目标表的分区方案。
一种方法是将整个表放在单个节点上，然后执行连接。然而，数据库管理系统失去了分布式数据库管理系统的并行性，这就违背了使用分布式数据库管理系统的目的。此选项还需要通过网络进行昂贵的数据传输。
要连接表R和表S, DBMS需要在同一节点上获得适当的元组。然后，它执行本学期早些时候讨论过的连接算法。应该始终发送计算连接所需的最小量，有时需要发送整个元组。
分布式连接算法有四种场景
## 场景1
在每个节点上复制其中一个表，另一个表跨节点分区。每个节点并行连接其本地数据，然后将其结果发送到协调节点。
## 场景2
两个表都在join属性上进行分区，每个节点上的id匹配。每个节点对本地数据执行连接，然后将其发送到另一个节点进行合并。
## 场景3
两个表在不同的键上进行分区。如果其中一个表很小，那么DBMS将把该表广播到所有节点。这让我们回到场景1。计算本地连接，然后将这些连接发送到公共节点以操作最终连接。这被称为广播连接。
## 场景4
这是最坏的情况。两个表都没有根据连接键进行分区。DBMS通过跨节点重组表来复制表。计算局部连接，然后将结果发送到公共节点以进行最终连接。如果没有足够的磁盘空间，故障是不可避免的。这被称为shuffle join。
## 半连接
是一种连接操作符，其结果只包含左表中的列。分布式dbms使用半连接来最小化连接期间发送的数据量。
它类似于自然连接，只是不用于计算连接的右表上的属性受到限制。
# Cloud Systems
供应商提供的数据库即服务(DBaaS)产品是托管DBMS环境。
较新的系统开始模糊无共享和共享磁盘之间的界限。例如，Amazon S3允许在将数据复制到计算节点之前进行简单的过滤。有两种类型的云系统:托管dbms或云原生dbms。
托管DBMS在托管DBMS中，不需要对DBMS进行重大修改以“意识到”它在云环境中运行。它提供了一种为客户端抽象所有备份和恢复的方法。大多数供应商都部署了这种方法。
云原生DBMS云原生系统被明确设计为在云环境中运行。这通常基于共享磁盘架构。这种方法在Snowflake、Google BigQuery、Amazon Redshift和Microsoft SQL Azure中使用。
无服务器数据库不总是为每个客户维护计算资源，而是在租户空闲时驱逐租户，并将系统中的当前进度检查到磁盘上。现在，用户只是在不主动查询时支付存储费用。图3显示了这一过程的示意图。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/26927011/1715359019179-0b5bb40b-d8c7-467e-9092-1a23f8678f4a.png#averageHue=%23f8f6f5&clientId=uaf2a2998-5421-4&from=paste&height=306&id=u4290deb4&originHeight=382&originWidth=535&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=65965&status=done&style=none&taskId=uc8033609-5d92-4132-bd2d-5077b1c7e82&title=&width=428)
# OLAP CommoditizationOLAP商品化
最近十年的一个趋势是将OLAP引擎子系统拆分为独立的开源组件。这通常是由不从事销售DBMS软件业务的组织完成的。这些组件通常是系统编目、查询优化器、文件格式/访问库和执行引擎。
系统目录DBMS在其目录中跟踪数据库的模式(表、列)和数据文件。如果DBMS在数据摄取路径上，那么它可以增量地维护目录。如果外部进程添加了数据文件，那么它还需要更新目录，以便DBMS知道它们。值得注意的例子包括HCatalog、Google Data Catalog和Amazon Glue Data Catalog。
查询优化器可扩展的搜索引擎框架，用于基于启发式和基于成本的查询优化。DBMS提供转换规则和成本估算。框架返回逻辑或物理查询计划。
这是在任何DBMS中最难构建的部分。著名的例子包括绿梅虎鲸和阿帕奇方解石

数据文件格式大多数dbms为其数据库使用专有的磁盘上二进制文件格式。在系统之间共享数据的唯一方法是将数据转换为通用的基于文本的格式，包括CSV、JSON和XML。
云供应商和分布式数据库系统支持新的开源二进制文件格式，这使得跨系统访问数据变得更加容易。编写自定义文件格式将带来更好的压缩和性能，但这也会带来更好的互操作性。

- Apache Parquet:来自Cloudera/Twitter的压缩柱状存储。
- Apache ORC:来自Apache Hive的压缩列存储。
- Apache CarbonData:使用华为索引的压缩列式存储。
- Apache Iceberg:灵活的数据格式，支持从Netflix的模式演变。
- HDF5:用于科学工作负载的多维阵列。
- Apache Arrow:来自Pandas/Dremio的内存压缩列式存储。

执行引擎用于在列数据上执行向量化查询操作符的独立库。输入是物理算子的有向无环图。它们需要外部调度和编排。值得注意的例子包括Velox、DataFusion和Intel OAP。
